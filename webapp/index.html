<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - App Sobriedad</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- App Container -->
    <div class="app-container active" id="appContainer">
        <!-- Home Page -->
        <div class="home-page page active" id="homePage">
            <div class="counter-container">
                <div class="counter-label">D√≠as sobrio</div>
                <div class="counter" id="dayCounter">0</div>
                <div class="symptom-label" id="symptomLabel">Ansiedad</div>
                <div class="motivational-phrase" id="motivationalPhrase">Inicia un nuevo cambio</div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="navigateTo('index.html')">
                <div class="nav-icon">üè†</div>
                <div class="nav-label">Home</div>
            </button>
            <button class="nav-item" onclick="navigateTo('calendar.html')">
                <div class="nav-icon">üìÖ</div>
                <div class="nav-label">Calendario</div>
            </button>
            <button class="nav-item" onclick="navigateTo('forum.html')">
                <div class="nav-icon">üí¨</div>
                <div class="nav-label">Foro</div>
            </button>
            <button class="nav-item" onclick="navigateTo('inspo.html')">
                <div class="nav-icon">‚≠ê</div>
                <div class="nav-label">Inspo</div>
            </button>
            <button class="nav-item" onclick="navigateTo('profile.html')">
                <div class="nav-icon">üë§</div>
                <div class="nav-label">Perfil</div>
            </button>
        </div>
    </div>

    <script>
        let currentUser = localStorage.getItem('currentUser');
        let persistentSession = localStorage.getItem('persistentSession');
        let startDate = null;

        // Redirect to login if not authenticated
        if (!currentUser || persistentSession !== 'true') {
            window.location.href = 'login.html';
        }

        // Update last activity timestamp to maintain session
        localStorage.setItem('lastActivity', new Date().toISOString());

        function navigateTo(page) {
            window.location.href = page;
        }

        function updateCounter() {
            if (!startDate) {
                startDate = new Date();
                saveData();
            }

            const today = new Date();
            const diffTime = Math.abs(today - new Date(startDate));
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            document.getElementById('dayCounter').textContent = diffDays;
            updateMotivationalPhrase(diffDays);
        }

        function updateMotivationalPhrase(days) {
            let phrase = '';
            let symptom = '';

            if (days === 0) {
                symptom = 'Ansiedad';
                phrase = 'Inicia un nuevo cambio';
            } else if (days < 7) {
                symptom = 'Ansiedad';
                phrase = 'Un d√≠a a la vez, ¬°vas bien!';
            } else if (days < 30) {
                symptom = 'Irritabilidad';
                phrase = 'T√∫ puedes, sigue adelante';
            } else if (days < 90) {
                symptom = 'Insomnio';
                phrase = '¬°Excelente progreso! Sigue as√≠';
            } else if (days < 180) {
                symptom = 'Fatiga';
                phrase = '¬°Incre√≠ble! Eres m√°s fuerte de lo que crees';
            } else {
                symptom = 'Estabilidad';
                phrase = '¬°Extraordinario! Eres un ejemplo de fortaleza';
            }

            document.getElementById('symptomLabel').textContent = symptom;
            document.getElementById('motivationalPhrase').textContent = phrase;
        }

        function saveData() {
            const key = `sobrietyApp_${currentUser}`;
            const saved = localStorage.getItem(key);
            const data = saved ? JSON.parse(saved) : {};

            data.startDate = startDate;
            localStorage.setItem(key, JSON.stringify(data));
        }

        function loadData() {
            const key = `sobrietyApp_${currentUser}`;
            const saved = localStorage.getItem(key);

            if (saved) {
                const data = JSON.parse(saved);
                startDate = data.startDate ? new Date(data.startDate) : new Date();
            } else {
                startDate = new Date();
            }
        }

        // Initialize
        loadData();
        updateCounter();
        setInterval(updateCounter, 60000);
    </script>
</body>
</html>